Тема 4. ПОДЗАПРОСЫ В SQL
Введение в SQL подзапросы
SQL подзапросы - это мощный инструмент в языке SQL, который позволяет выполнять операции на основе результатов других SQL запросов. Они позволяют вам создавать более сложные запросы, комбинируя данные из разных таблиц или выполняя операции над подмножествами данных.

Примеры SQL запросов
Пример: Выборка компаний и имен заказчиков
ВЫБЕРИТЕназвание компании_ 
Упоставщиков 
ГДЕ НАХОДИТСЯ страна В (ВЫБЕРИТЕ страну Из списка клиентов)


ВЫБЕРИТЕ РАЗЛИЧНЫХ поставщиков.имя_компании
Изсписка поставщиков 
ПРИСОЕДИНЯЙТЕСЬ К клиентам, ИСПОЛЬЗУЮЩИМ (страна)
Пример: Суммирование товаров по категориям и использование подзапроса в LIMIT
SELECT category_name, SUM(units_in_stock)
FROM products
INNER JOIN categories ON products.category_id = categories.category_id
GROUP BY category_name
ORDER BY SUM(units_in_stock) DESC
LIMIT (SELECT MIN(product_id) + 4 FROM products)
Пример: Вычисление среднего количества товаров в наличии и выбор товаров, у которых количество в наличии больше среднего
СРЕДНЕЕ ЗНАЧЕНИЕ ВЫБОРА(units_in_stock)
ИЗпродукции 


ВЫБЕРИТЕ product_name, units_in_stock 
Изproducts 
ГДЕ units_in_stock > (ВЫБЕРИТЕ СРЕДНЕЕ ЗНАЧЕНИЕ(units_in_stock) ИЗ товаров)
ЗАКАЗАТЬ По units_in_stock
ГДЕ СУЩЕСТВУЕТ
WHERE EXISTS - это условие, которое используется для проверки наличия результатов подзапроса.

Пример: Выбор компаний и имен заказчиков, которые делали заказы в определенный период
ВЫБЕРИТЕ название компании, имя_контакта 
Уклиентов 
ГДЕ СУЩЕСТВУЕТ (ВЫБЕРИТЕ customer_id ИЗ заказов
 ГДЕ customer_id = клиенты.customer_id И 
 фрахт ОТ 50 До 100); 


ВЫБЕРИТЕ название компании, имя_контакта 
Изcustomers 
ГДЕ СУЩЕСТВУЕТ (ВЫБЕРИТЕ customer_id ИЗ заказов
 ГДЕ customer_id = клиенты.customer_id И 
 дата заказа Между '1995-02-01' И '1995-02-15'); 


ВЫБЕРИТЕ название компании, контактное лицо 
Уклиентов 
ГДЕ НЕ СУЩЕСТВУЕТ (ВЫБЕРИТЕ customer_id ИЗ заказов
 ГДЕ customerid = клиенты.customerid И 
 дата заказа Между '1995-02-01' И '1995-02-15');
Подзапросы с квантификаторами ANY и ALL
Подзапросы с квантификаторами ANY и ALL позволяют сравнивать значение из основного запроса с набором значений, возвращаемых подзапросом.

Пример: Выбор компаний заказчиков, которые сделали заказы на более чем 40 единиц товаров
ВЫБЕРИТЕ ОТДЕЛЬНОЕназвание компании 
Изcustomers 
ПРИСОЕДИНЯЙТЕСЬ К заказам, ИСПОЛЬЗУЯ (customer_id)
ПРИСОЕДИНЯЙТЕСЬ К order_details, ИСПОЛЬЗУЯ(order_id)
ГДЕ количество > 40; 

ВЫБЕРИТЕ ОТДЕЛЬНОЕназвание компании 
ОТклиентов 
ГДЕ customer_id = ЛЮБОЙ(ВЫБЕРИТЕ customer_id ИЗ заказов
 ПРИСОЕДИНЯЙТЕСЬ К order_details, ИСПОЛЬЗУЯ(order_id)
 ГДЕ количество > 40);
Пример: Выбор товаров, количество которых больше среднего по заказам
СРЕДНИЙ ВЫБОР(количество)
ИЗorder_details; 


ВЫБЕРИТЕ ДРУГОЕ название продукта, количество 
Изproducts 
ПРИСОЕДИНИТЕСЬ К order_details, ИСПОЛЬЗУЯ (product_id)
ГДЕ количество > (ВЫБЕРИТЕ СРЕДНЕЕколичество) ИЗ order_details);
Пример: Выбор товаров, количество которых больше среднего значения по каждой категории товаров
СРЕДНИЙ ВЫБОР(количество)
ИЗorder_details 
СГРУППИРОВАТЬ Поproduct_id; 


ВЫБРАТЬ ОТДЕЛЬНОЕ product_name, количество 
Изproducts 
ПРИСОЕДИНЯЙТЕСЬ К order_details, ИСПОЛЬЗУЯ (product_id)
ГДЕ количество > ВСЕ
 (ВЫБЕРИТЕ СРЕДНЕЕколичество)
 ИЗ order_details
 ГРУППИРОВАТЬ ПО product_id)
ЗАКАЗ По количеству;
